\documentclass[a4paper,11pt,DIV=11,BROC=5mm,bigheadings,idxtotoc,cleardoubleempty,halfparskip,oneside,openright]{scrreprt} % 

\usepackage{datetime}

\usepackage{graphicx}
\usepackage{xcolor}
\usepackage{tikz}
\usetikzlibrary{arrows, snakes, backgrounds}
\usepackage{wrapfig}

\usepackage{blindtext}

\usepackage{cite}% Zitieren
\usepackage{bibgerm}% Literatur in Deutscher DIN
\usepackage{url}


\usepackage{amsmath}
\usepackage{amssymb}

\usepackage{listings}

\usepackage[utf8]{inputenc}
\usepackage{lmodern}

\usepackage{microtype}


\usepackage{scrpage2} 	% Kopf & Fußzeile im KOMA Stil
\pagestyle{scrheadings}	% Aktiviert Verwendung vordefinierter Kolumnentitel
\clearscrheadfoot 		% alle Standard-Werte und Formatierungen löschen
\setkomafont{pagehead}{\scshape}	% Schriftart in Kopfzeile, \scshape = Kapitelchen
\automark[chapter]{section} % [linke Seite]{rechte Seite}
%\ohead{\def\pagestyle{PDTS}{\hrulefill\includegraphics[width = 6cm]{bilder/thi_logo_quer_cropped}}}
\ohead{\includegraphics[width = 6cm]{bilder/thi_logo_quer_cropped}}

%\ihead{\textsc{Abschlussarbeit}}
\ihead{\headmark}

%\setheadwidth[0pt]{textwithmarginpar}
\ofoot{\vspace{-0.3cm} \pagemark} 						
\ifoot{\vspace{-0.3cm} Dominik Gunther Florian Schlecht} 
				
%\setheadtopline{2pt}				
%\setheadsepline{.4pt}
\setfootsepline{.4pt}	% Trennlinie Fußzeile und Textkörper

%-------------------------------------------------------------






%------------------------------------------------------------------
%% Längenanpassungen
%------------------------------------------------------------------

\setlength{\headsep}{10mm}				% Textabstand zur Kopfzeile
\setlength{\footskip}{15mm}				% Abstand zur Fußzeile
\setlength{\parindent}{0em}				% Einzug nach Absatz

%------------------------------------------------------------------
%% THI - Farbdefinitionen
%------------------------------------------------------------------

% Farben der THI
\definecolor{THIblue}{rgb}{0.0078,0.1176,0.4705}
%%-------------Allgemeine Definitionen----------------------------------
% Farbige Aufwertung der berschriften
\addtokomafont{chapter}{\color{THIblue}}
\addtokomafont{section}{\color{THIblue}}
\addtokomafont{caption}{\color{THIblue}}
\addtokomafont{subsection}{\color{THIblue}}
\addtokomafont{subsubsection}{\color{THIblue}}
\setkomafont{captionlabel}{\color{THIblue}}

%------------------------------------------------------------------
%% Interessante optinale Packages
%------------------------------------------------------------------

% -> Verlinkter Text im PDF
	\usepackage[
			pdftex,
			linkcolor=THIblue,			% Farbe der Verlinkung
			linktocpage=true,			% Im TOC wird Seitenzahl verlinkt(true),bzw. Text(false)
			colorlinks=true,			% 'true' keinen Kasten um Link
	%		citecolor=blue,
	%		pdfhighlight=/P,
	%		bookmarks,
	%		hyperfigures=true,
	%		citebordercolor={0 0 1},
	%		linkbordercolor={0 0 1},
	%		menubordercolor={0 0 1},
	%		backref=true,
	%		pagebackref=true,
	%%		bookmarksopen,
	%		bookmarksnumbered,
	%		pdfpagelabels=false,
	%		pdfstartpage=1,
	%		pdfstartview=Fit,			% Modus beim Öffnen (Fit = An Seitengröße anpassen)
			pdftitle={Umgehen von PID und VID basierten USB-Policies},
			pdfauthor={Dominik Schlecht},
	%		pdfstartview=Fit,
	%		pdfdisplaydoctitle=true,
	%		plainpages=false
				]{hyperref}  



%------------------------------------------------------------------
%% Wichtige Definition für Aufteilung von Formelverzeichnis und Abkürzungsverzeichnis
%------------------------------------------------------------------

% Nomenklaturverzeichnis, Formelzeichenliste Anpassungen für nomenclature: damit lassen sich zwei getrennte Symbolverzeichnisse anlegen, ziehmlich cool!
\usepackage[intoc,compatible,german]{nomencl}	
		\renewcommand{\nomgroup}[1]{	\ifthenelse{\equal{#1}{A}}{\item[{\normalfont\sffamily\bfseries\LARGE\textcolor[rgb]{0,0.112,0.47}{Abkürzungen{\phantom{\Huge $\frac{\frac{\frac{A}{a}}{a}}{\frac{a}{a}}$}}}}]}{	\ifthenelse{\equal{#1}{A}}{\item[{\normalfont\sffamily\bfseries\LARGE\textcolor[rgb]{0,0.112,0.47}{Formelzeichen{\phantom{\Huge $\frac{A}{\frac{a}{a}}$}}}}]}{}}}
		
%% z.B. (1)  \nomenclature{$v_0$}{Startgeschwindigkeit}   -> Formelverzeichnis
\nomenclature[A]{SAF}{Security Awareness Framework}



%------------------------------------------------------------------
%% Anpassung von Abständen, Längen vom Nomenclaturverzeichnis (Abkürzungs- und Formelverzeichnis)
%------------------------------------------------------------------

		% Abstand zwischen Einträgen im Symbolverzeichnis (-\parsep = 0)
		\setlength{\nomitemsep}{-\parsep} 
		\setlength{\nomlabelwidth}{5em}	
		\renewcommand{\nomlabel}[1]{#1 \dotfill}  % Punkte im zwischen Nummer und Kapiteleintrag






%------------------------------------------------------------------
%% Definition Standardordner der Bilddatein für schnellen Zugriff
%------------------------------------------------------------------
%
%\newcommand\figpfad{bilder/}
%


%%-------------Silbentrennung--------------------------------------
\hyphenation{}

%%-------------Index-----------------------------------------------
\makeindex
\makenomenclature

%------------------------------------------------------------------
% Angabe der zu verwendenden Dateien, sodass nur z.B. das aktuelle 
% Dokument compiliert wird; den Rest mit % auskommentieren
		\includeonly{%
			chapter/title_page,%
			chapter/thanks_statement,
            chapter/einleitung,
            chapter/USB,
            chapter/UmgehenUSBPolicies,
			chapter/appendix%
		}


%------------------------------------------------------------------------

%-----------------------------------------------------------------
%---------------Dokumentenbeginn----------------------------------
%-----------------------------------------------------------------
	\begin{document}
			
			\include{chapter/title_page}			
				\cleardoublepage

			\include{chapter/thanks_statement}
				\cleardoublepage	
					
			% Inhaltsverzeichnis
			%\setcounter{\secnumdepth}{2} % Zwei Ebenen im Inhaltsverzeichnis auflisten
			\tableofcontents
				\cleardoublepage	
		
			% Abkrzungsverzeichnis
			\printnomenclature
				\cleardoublepage	
			
%------------------------------------------------------------------------
			% Neunummerierung des Hauptteils
			\pagenumbering{arabic}
			\setcounter{page}{1}            
            \cleardoublepage
            
            \include{chapter/einleitung}
                \cleardoublepage
                
			\chapter{Motivation}
Bei einer Prüfung interner Regularien bei der Informationssicherheit wurde das Thema USB-Geräte in Verbindung mit Thin oder auch sogenannten Zero-Clients aufgegriffen. Hier soll aus gegeben fachlichen Anlässen eine Möglichkeit geschaffen werden lokale USB-Geräte, wie z.B. USB-Sticks oder USB-CD-Laufwerke, an die virtuelle Maschine des Benutzers durch zu stellen. Hier galt es das Risiko zu Prüfen und entsprechende Gegenmaßnahmen zu entwicklen. Würde man das Durchstellen von USB-Geräten jedoch im Allgemeinen erlauben, so würden sich erheblich Gefahren ergeben, welche unter \ref{GefBeiUSB} erläutert werden. Um dem Vorzubeigen, soll auf Basis einer Policie, welche in \ref{Policies} weiter erläutert werden, das Durchstellen auf bestimmte Geräte begrenzt werden. Dies geschieht im normalfall über die Filterung nach PID und VID, welche eine Produkt, z.B. einen bestimmten USB-Stick, eindeutig Identifiezieren sollten. Diese Felder werden unter \ref{descriptoren} weiter erläutert. Bei der durchgeführten Sicherheitsprüfung stellte sich jedoch heraus, dass diese Filterung durch die Fälschung der PID und VID leicht gefälscht werden können. Der Angriff, \ref{Angriff}, soll in diesem Dokument erläuter und Aufgezeigt werden. Den Proof-Of-Concept finden Sie untern \ref{PoC}.

\begin{figure}[htbp]
\begin{tikzpicture}[
	scale=1,
	line width=0.25mm,
	every node/.style={
		scale=1, 
		text=THIblue},
	align=center,
	node distance=4cm,
	comp/.style={
		fill=white,
		rectangle,
		draw,
		minimum size=2.5cm},
	driver/.style={
		fill=white,
		rectangle,
		draw,
		yshift=2cm,
		xshift=-1cm},
	device/.style={
		fill=white,
		rectangle,
		draw},
	policie/.style={
		fill=white,
		rectangle,
		draw,
		yshift=-2cm,
		xshift=-1.5cm}
	]
	
	\node[comp] (thinclient) at (0,0){Thinclient};
	\node[driver] (thinclientUSB) [below right of=thinclient] {USB-Treiber};
	\node[device] (USBDevice) [right of=thinclientUSB, xshift=-1cm] {USB-Device};

	\node[comp] (hypervisor) [above of=thinclient] {Hypervisor};
	\node[driver] (hypervisorUSB) [below right of=hypervisor] {USB-Treiber};
	\node[policie] (hypervisorPol) [above right of=hypervisor] {Policie};
	
	\node[comp] (VM) [above of=hypervisor] {VM};
	\node[driver] (VMUSB) [below right of=VM] {USB-Treiber};
	\node[policie] (VMPol) [above right of=VM] {Policie};
		
	\draw[->]
		(USBDevice) --
			node[above]{1.}
				(thinclientUSB);	
	
	\draw[<->]
		(thinclientUSB) -- 
			node[right]{2.}
				++(0,-1) -| (USBDevice);
	
	\draw[->]
		(thinclient.125) -- 
			node[left]{3.}
				(hypervisor.235);
	
	\draw[<->]
		(hypervisor.10) -- 
			node[above]{4.}
				++(2.5,0) |- (hypervisorPol);
	
	\draw[->]
		(hypervisor.270) -- 
			node[left]{5.}
				(thinclient.90);
				
	\draw[->]
		(thinclient.55) -- 
			node[left]{6.}
				++(0,1.25)-|(hypervisorUSB);
	
	\draw[->]
		(hypervisor) --
			node[left]{7.}
				++(0,2.5)-|(VMUSB);
	
	\draw[<->]
		(VM.10) --
			node[above]{8.}
				++(2.5,0) |- (VMPol);
	
\end{tikzpicture}
\caption{Ablaufübersicht}
\label{fig:ablauf}
\end{figure}

\begin{description}
	\item[Schritt 1: ] Ein USB-Gerät wird angesteckt.
	\item[Schritt 2: ] Der USB-Treiber des Thinclients bindet das Gerät ein. TODO Prüfen
	\item[Schritt 3: ] Der Thinclient leitet entsprechende Descriptor-Felder an den Hypervisor weiter.
	\item[Schritt 4: ] Der Hypervisor prüft die Descriptor-Felder gegen die Hypervisor-Policie. Diese erlaubt entweder das Durchstellen oder Verbietet es. Wird die Durchstellung verboten, wird der USB-Stick nicht durchgestellt und damit würde der Ablauf enden. Im Folgenden wird angenommen, dass der USB-Stick durchgestellt wird.
	\item[Schritt 5\&6: ] Der Hypervisor fordert den USB-Stick beim Thinclient an und bindet diesen ein.
	\item[Schritt 7: ] Der Hypervisor gibt das USB-Device an die VM weiter.
	\item[Schritt 8: ] Die VM prüft das USB-Device anhand der Descriptor-Felder gegen die VM-Policie und stellt diesen bindet diesen entweder ein oder lehnt diesen ab.
\end{description}

			\include{chapter/USB}
			
			
			\chapter{Policies} \label{Policies}
Policies sind Regelwerke, welche in IT-Systemen, aber auch als interne Regelungen in Unternehmen zum Einsatz kommen. TODO


			\include{chapter/UmgehenUSBPolicies}

			\chapter{Ausblick in die Zukunft}			
			
			\chapter{Gegenmaßnahmen}
	
			
%------------------------------------------------------------------------
			
			% Anhang
			\include{chapter/appendix}
			
			% Literaturliste
			\newpage
			\bibliographystyle{plaindin}	% DIN Norm für Literaturdarstellung
			\bibliography{ref/ref_liste}	% Pfad und Datei der Ref-Datenbank
		
	\end{document}
%-----------------------------------------------------------------
